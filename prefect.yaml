name: custard-dlt
requires:
  - prefect-gcp

deployments:
  - name: generate_schedule_agreements
    entrypoint: flows/generate_schedule_agreements.py:generate_schedule_agreements
    work_pool:
      name: work-pool-1
      job_variables:
        env:
          DESTINATION__BIGQUERY__LOCATION: "europe-west10"
          DESTINATION__BIGQUERY__CREDENTIALS__PROJECT_ID: "{{ prefect.blocks.secret.bq-project-id }}"
          DESTINATION__BIGQUERY__CREDENTIALS__PRIVATE_KEY: "{{ prefect.blocks.secret.bq-private-key }}"
          DESTINATION__BIGQUERY__CREDENTIALS__CLIENT_EMAIL: "{{ prefect.blocks.secret.bq-client-email }}"
          DESTINATION__DATASET: "public"

    pull:
      - prefect.deployments.steps.git_clone:
          id: clone-step
          repository: https://github.com/okharedia/custard-dlt.git
          credentials: "{{ prefect.blocks.github-credentials.credentials-1 }}"
      - prefect.deployments.steps.pip_install_requirements:
          directory: "{{ clone-step.directory }}"
          requirements_file: requirements.txt
